<!DOCTYPE html>
<html>
    <head>
        <title>
            Javascript DOM
        </title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>

        <script type="text/javascript">
            class ProductController {
                constructor() {
                    this.txtProductName = document.querySelector('#txtProductName');
                    this.txtProductPrice = document.querySelector('#txtProductPrice');
                    this.txtProductDescription = document.querySelector('#txtProductDescription');
                    this.productList = document.querySelector('#productList');
                    this.btnAddProduct = document.querySelector('#btnAddProduct');
                    this.spanTotal = document.querySelector('#spanTotal');
                    this.txtSearchProduct = document.querySelector('#txtSearchProduct');
                    this.products = new Array();

                    let addProductList = this.addProduct.bind(this);
                    this.btnAddProduct.addEventListener('click', addProductList);

                    let searchProductNameKeyup = this.searchProductName.bind(this);
                    this.txtSearchProduct.addEventListener('keyup', searchProductNameKeyup);
                }

                addProduct(event) {
                    this.products.push({
                        name: this.txtProductName.value,
                        price: parseFloat(this.txtProductPrice.value),
                        description: this.txtProductDescription.value
                    });

                    this.displayProducts(this.products);
                }

                searchProductName(event) {
                    /**
                     * Ejercicio:
                     * Hacer que la búsqueda de los nombres de products
                     * sea indistinta por mayusculas o minúsculas.
                     * 10:50
                     */

                    let products = this.products.filter(
                        product => product.name.toUpperCase().indexOf(this.txtSearchProduct.value.toUpperCase()) >= 0
                    );

                    this.displayProducts(products);
                }

                displayProducts(products) {
                    this.productList.innerHTML = '';
                    /**
                     * Ejercicio
                     * En la medida en que se introducen los productos
                     * visualizar el total de precios
                     * en spanTotal
                     * 
                     * 9:45
                     */

                    for (let product of products) {
                        let tr = document.createElement('tr');
                        let tdProductName = document.createElement('td');
                        let tdProductPrice = document.createElement('td');
                        let tdProductDescription = document.createElement('td');

                        tdProductName.innerHTML = product.name;
                        tdProductPrice.innerHTML = product.price;
                        tdProductDescription.innerHTML = product.description;

                        tr.appendChild(tdProductName);
                        tr.appendChild(tdProductPrice);
                        tr.appendChild(tdProductDescription);

                        this.productList.appendChild(tr);
                    }

                    this.spanTotal.innerHTML = products.map(product => product.price).reduce((total, price) => {
                        return total + price;
                    })
                }
            }

            window.onload = function() {
                new ProductController();
            }
        </script>
    </head>
    <body>
        <div class="container">
            <h2 class="bg-primary text-white p-3">
                Javascript DOM
            </h2>
            <form class="m-3">
                <div>
                    <label for="txtProductName">Product name:</label>
                    <input id="txtProductName" type="text" class="form-control">
                </div>
                <div>
                    <label for="txtProductPrice">Product price:</label>
                    <input id="txtProductPrice" type="number" class="form-control">
                </div>
                <div>
                    <label for="txtProductDescription">Product description:</label>
                    <textarea id="txtProductDescription" class="form-control"></textarea>
                </div>
                <div>
                    <button id="btnAddProduct" type="button" class="btn btn-primary">Add product</button>
                </div>
            </form>
            <table class="table table-dark">
                <thead>
                    <tr>
                        <input id="txtSearchProduct" placeholder="Search...">
                    </tr>
                    <tr>
                        <th>
                            Product name
                        </th>
                        <th>
                            Product price
                        </th>
                        <th>
                            Product description
                        </th>
                    </tr>
                </thead>
                <tbody id="productList"></tbody>
                <tfoot>
                    <tr>
                        <td>
                            Total:
                        </td>
                        <td>
                            <span id="spanTotal"></span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </body>
</html>